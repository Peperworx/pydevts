# PYDEVTS Communication protocol

The PYDEVTS communication protocol is build on UDP and designed similar to TCP, with some added features.

## Connection Types

The PYDEVTS protocol has two connection types. Stream and message.

### Stream

The stream protocol type is most similar to TCP. You send and receive data in a connection, and then disconnect when you are done sending data.

### Message

The message protocol is the hybrid of UDP and TCP. The server sends a datagram, and if it does not receive an acknowledgement within a specified timeout, it sends it again. This is designed with the idea of delivering messages quickly without losing data. The message protocol is not ordered, meaning packets may not arrive in the order they were sent, and is designed for use in event systems, as well as other pseudo "fire-and-forget" systems.

## Security

The protocol is secured using an initial exchange including two messages, sent in plaintext, using the message connection type. The first message contains the following information:

- Contacting node's public key used for encryption
- Contacting node's public key used for signing
- Random 64 bit number generated by contacting node.

Once this message is received, the contacted node generates 32 bytes of data, and xor's the recieved random number with it (Looping the recieved number over and over again)

It then sends the second message as a response to the first:

- Contacted node's public key used for encryption
- Contacted node's public key used for signing
- The previously generated 32 bytes (not xored, and encrypted with the contacting node's public key for encryption)


The contacting node then decrypts the 32 bytes and xors them. (This is used to ensure that a random number generator on one of the systems can not be rigged)

Those 32 bytes are then used to seed a random number generator, which is only used for the task of encryption for those two specific nodes, and each further message or datagram to the other node is sent AES encrypted with a number pulled from that number generator. 